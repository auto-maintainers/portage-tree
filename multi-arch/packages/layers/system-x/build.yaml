requires:
- category: "development"
  name: "mocaccino-overlay-x"
  version: ">=0"
unpack: true
env:
- FEATURES="-sandbox -usersandbox -ipc-sandbox -pid-sandbox"
- JOBS=7
steps:
# we want py3.8 and py2.7 for now
- eval 'emerge --unmerge dev-lang/python:3.9 dev-lang/python:2.7 dev-lang/ruby:2.5 || true'
- USE=-harfbuzz emerge media-libs/freetype -j $JOBS
- emerge dev-perl/XML-Parser -j $JOBS
- emerge -uDNv --with-bdeps=y --backtrack=100 --autounmask-keep-masks=y @world -j $JOBS
- emerge sys-apps/systemd
- perl-cleaner --all

excludes:
- ^/etc/shadow
- ^/etc/os-release
- ^/etc/gshadow
- ^/etc/group
- ^/etc/hostname
- ^/etc/hosts
- ^/etc/machine-id
- ^/etc/fstab
- ^/etc/passwd
- ^/etc/machineid
- ^/var/db/repos
- ^/var/db/pkg
- ^/var/lib/portage
- ^/var/cache/distfiles
- ^/var/log
- ^/var/cache/edb
- ^/usr/portage
- ^/sys
- ^/proc
# GCC split
- ^/etc/env.d/gcc.*
- ^/usr/lib/debug/usr/lib/gcc.*
- ^/usr/lib/gcc/x86_64-pc-linux-gnu.*
- ^/usr/share/gcc-data/x86_64-pc-linux-gnu.*
- ^/usr/bin/c++-{{.Values.version}}
- ^/usr/bin/cpp-{{.Values.version}}
- ^/usr/bin/g++-{{.Values.version}}
- ^/usr/bin/gcc-{{.Values.version}}
- ^/usr/bin/gccgo-{{.Values.version}}
- ^/usr/bin/gcov-{{.Values.version}}
- ^/usr/bin/gfortran-{{.Values.version}}
- ^/usr/bin/x86_64-pc-linux-gnu-c++-{{.Values.version}}
- ^/usr/bin/x86_64-pc-linux-gnu-cpp-{{.Values.version}}
- ^/usr/bin/x86_64-pc-linux-gnu-g++-{{.Values.version}}
- ^/usr/bin/x86_64-pc-linux-gnu-gcc-{{.Values.version}}
- ^/usr/bin/x86_64-pc-linux-gnu-gccgo-{{.Values.version}}
- ^/usr/bin/x86_64-pc-linux-gnu-gcov-{{.Values.version}}
- ^/usr/bin/x86_64-pc-linux-gnu-gfortran-{{.Values.version}}
- ^/usr/lib/gcc/x86_64-pc-linux-gnu.*
- ^/usr/lib/go.*
- ^/usr/lib64/go.*
- ^/usr/libexec/gcc.*
- ^/usr/share/gcc-data.*
- ^/usr/x86_64-pc-linux-gnu/gcc-bin.*
